{% extends 'base.html' %}

{% block title %}Music{% endblock %}

{% block content %}
<div class="container music-page">

    <!-- 1. Top Performing -->
    <section class="top-tracks">
        <h2>Top Tracks</h2>
        <div class="spotify-embed-container"
            style="display: flex; flex-direction: column; gap: 1rem; align-items: center;">
            {% if top_tracks %}
            {% for track in top_tracks %}
            <iframe style="border-radius:12px"
                src="https://open.spotify.com/embed/track/{{ track.id }}?utm_source=generator&theme=0" width="100%"
                height="152" frameBorder="0" allowfullscreen=""
                allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                loading="lazy"></iframe>
            {% endfor %}
            {% else %}
            <iframe style="border-radius:12px"
                src="https://open.spotify.com/embed/track/3b3VmMwvuKGPDNcUdYmLBh?utm_source=generator&theme=0"
                width="100%" height="152" frameBorder="0" allowfullscreen=""
                allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                loading="lazy"></iframe>
            <iframe style="border-radius:12px"
                src="https://open.spotify.com/embed/track/0shpPfrxAqZgu2bpeKo86E?utm_source=generator&theme=0"
                width="100%" height="152" frameBorder="0" allowfullscreen=""
                allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                loading="lazy"></iframe>
            <iframe style="border-radius:12px"
                src="https://open.spotify.com/embed/track/58P64V8UDPqOOmlXJpYLfn?utm_source=generator&theme=0"
                width="100%" height="152" frameBorder="0" allowfullscreen=""
                allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                loading="lazy"></iframe>
            {% endif %}
        </div>
    </section>

    <!-- 2. Latest Release -->
    <section class="latest-release-highlight">
        <h2>Latest EP</h2>
        <div class="spotify-embed-container" style="display: flex; justify-content: center;">
            {% if settings and settings.latest_release_id %}
            <iframe style="border-radius:12px"
                src="https://open.spotify.com/embed/album/{{ settings.latest_release_id }}?utm_source=generator"
                width="100%" height="352" frameBorder="0" allowfullscreen=""
                allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                loading="lazy"></iframe>
            {% else %}
            <iframe style="border-radius:12px"
                src="https://open.spotify.com/embed/album/4zdanK4qRRjCe0N4XXToBt?utm_source=generator" width="100%"
                height="352" frameBorder="0" allowfullscreen=""
                allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                loading="lazy"></iframe>
            {% endif %}
        </div>
    </section>

    <!-- 3. Upcoming/Unreleased (Hype) -->
    <section class="hype-section">
        <h2>Upcoming Drop</h2>
        <div class="countdown-container">
            <div class="countdown-timer" id="countdown">
                <div><span id="days">00</span>Days</div>
                <div><span id="hours">00</span>Hrs</div>
                <div><span id="minutes">00</span>Min</div>
                <div><span id="seconds">00</span>Sec</div>
            </div>
            <p class="hype-text">"The Next Chapter Begins"</p>
            <form class="presave-form">
                <input type="email" placeholder="Enter your email to join the waitlist" required
                    style="padding: 1rem; border: none; min-width: 250px; color: var(--text-color); background-color: var(--bg-color);">
                <button type="submit">Notify Me</button>
            </form>
        </div>
    </section>

</div>
{% endblock %}

{% block scripts %}
<script>
    // Countdown Timer Logic
    const dropDateStr = "{{ settings.upcoming_drop if settings and settings.upcoming_drop else 'Dec 31, 2026 00:00:00' }}";
    const countDownDate = new Date(dropDateStr).getTime();

    const x = setInterval(function () {
        const now = new Date().getTime();
        const distance = countDownDate - now;

        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);

        document.getElementById("days").innerHTML = days;
        document.getElementById("hours").innerHTML = hours;
        document.getElementById("minutes").innerHTML = minutes;
        document.getElementById("seconds").innerHTML = seconds;

        if (distance < 0) {
            clearInterval(x);
            document.getElementById("countdown").innerHTML = "DROPPED";
        }
    }, 1000);
</script>
{% endblock %}